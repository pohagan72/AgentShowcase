{# features/translation/templates/translation_content.html #}

<!-- NEW: Isolated styles for this template only -->
<style>
    .translation-feature-container .feature-note {
        margin-top: 0.75rem;
        margin-bottom: 1.5rem; /* Increased bottom margin for better spacing */
        padding: 0.8rem 1rem;
        background-color: #f0f9ff;
        border: 1px solid #e0f2fe;
        border-left: 5px solid var(--primary-color, #3b82f6);
        border-radius: 6px;
        font-size: 0.95em;
        color: #0c4a6e;
        display: flex;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .translation-feature-container .feature-note i {
        margin-right: 1rem;
        font-size: 1.6em;
        color: var(--primary-color, #3b82f6);
        opacity: 0.85;
        flex-shrink: 0;
    }
    .translation-feature-container .feature-note p {
        margin: 0;
        line-height: 1.6;
    }
    .translation-feature-container .feature-note strong {
        font-weight: 600;
        color: var(--primary-color-dark, #2563eb);
    }
    /* Adjust description margin to accommodate the new note box */
    .translation-feature-container .feature-description {
        margin-bottom: 0.5rem;
    }
</style>

<div class="feature-container translation-feature-container">
    <h1><i class="fas fa-language"></i> Native File Translation</h1>

    <p class="feature-description">
        Our <strong>custom AI Agent</strong> orchestrates a sophisticated, multi-step translation workflow. It begins by parsing native Word, PowerPoint, and Excel files, performing a structured linguistic analysis to determine the source language. The agent then <strong>dynamically generates context-aware prompts</strong> for any specified GenAI model, ensuring linguistic nuances and technical terminology are preserved. Finally, it reassembles the translated content into two <strong>high-fidelity formats</strong>: a new file in the original native format, and a clean Markdown version for immediate review and system integration.
    </p>
    <div class="feature-note">
        <i class="fas fa-server"></i>
        <p>While this demonstration showcases the agent on a single document, the underlying architecture is engineered for <strong>enterprise scale</strong>, capable of processing documents thousands of pages in length.</p>
    </div>

    {% if not gcs_available or not gemini_configured %}
        <div class="error-message" style="margin-bottom: 20px;">
            <strong>Configuration Issue:</strong>
            {% if not gcs_available %}Google Cloud Storage is not available. {% endif %}
            {% if not gemini_configured %}Google Gemini AI is not configured. {% endif %}
            File processing for translation is disabled. Please check server logs and environment variable settings.
        </div>
    {% endif %}

    <form method="POST" action="{{ url_for('process_translate_document') }}" enctype="multipart/form-data"
          hx-post="{{ url_for('process_translate_document') }}"
          hx-target="#translation-results-area"
          hx-swap="innerHTML"
          hx-encoding="multipart/form-data"
          hx-indicator="#translation-submit-button .spinner">
        
        <div class="form-group">
            <label for="translation-file-input" id="translation-drop-zone-label" class="drop-zone-style">
                <p>Drop .docx, .pptx, .xlsx file here, or click to select.</p>
                <p id="translation-file-name-display">No file selected</p>
            </label>
            <input type="file" id="translation-file-input" name="file" accept=".docx,.pptx,.xlsx" required style="display: none;">
        </div>

        <div class="form-group">
            <label for="translation-target-language">Target Language:</label>
            <select id="translation-target-language" name="target_language" required 
                    {% if not gemini_configured %}disabled{% endif %}>
                {% if not languages and gemini_configured %}
                    <option value="" disabled selected>No languages configured</option>
                {% elif not gemini_configured %}
                     <option value="" disabled selected>Gemini Service Not Configured</option>
                {% else %}
                    {% for lang in languages %}
                        <option value="{{ lang }}">{{ lang }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>

        <div class="submit-area">
            <button type="submit" class="submit-button" id="translation-submit-button"
                    {% if not gcs_available or not gemini_configured %}disabled aria-disabled="true" title="Translation service is not fully configured." {% endif %}>
                <i class="fas fa-cogs"></i> Translate File
                <span class="htmx-indicator spinner"></span>
            </button>
        </div>
    </form>
    
    <div id="translation-results-area" class="processing-result" style="margin-top: 1.5rem; border: none; padding: 0; background-color: transparent; min-height: 0;">
        <!-- Results will be loaded here by HTMX -->
    </div>

</div>

<script>
// This JavaScript remains the same.
(function() {
    const translationFeatureContainer = document.querySelector('.translation-feature-container');
    if (!translationFeatureContainer) return;

    const dropZoneLabel = translationFeatureContainer.querySelector('#translation-drop-zone-label');
    const fileInput = translationFeatureContainer.querySelector('#translation-file-input');
    const fileNameDisplay = translationFeatureContainer.querySelector('#translation-file-name-display');

    if (dropZoneLabel && fileInput && fileNameDisplay) {
        dropZoneLabel.addEventListener('dragover', (e) => { e.preventDefault(); dropZoneLabel.classList.add('drag-over'); });
        dropZoneLabel.addEventListener('dragleave', () => { dropZoneLabel.classList.remove('drag-over'); });
        dropZoneLabel.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZoneLabel.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                const event = new Event('change', { bubbles: true });
                fileInput.dispatchEvent(event);
            }
        });

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileNameDisplay.textContent = fileInput.files[0].name;
                dropZoneLabel.classList.add('file-selected');
            } else {
                fileNameDisplay.textContent = 'No file selected';
                dropZoneLabel.classList.remove('file-selected');
            }
        });
    }
})();
</script>