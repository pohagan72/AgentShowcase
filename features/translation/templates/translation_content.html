{# features/translation/templates/translation_content.html #}
<style>
    /* Scoped styles for Translation feature specifics */
    .translation-feature-container .feature-description { 
        margin-bottom: 2rem; 
        color: var(--text-secondary);
        font-size: 1.05rem;
        line-height: 1.6;
    }
    
    .translation-feature-container .feature-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
        gap: 1.5rem; 
        margin-bottom: 2.5rem; 
    }
    
    .translation-feature-container .feature-item { 
        background: #ffffff; 
        padding: 1.5rem; 
        border-radius: var(--radius-md); 
        border: 1px solid var(--border-subtle); 
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .translation-feature-container .feature-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-color: var(--brand-primary);
    }

    .translation-feature-container .feature-item h4 { 
        margin: 0 0 0.5rem 0; 
        font-family: var(--font-sans); 
        font-size: 1rem; 
        color: var(--text-primary); 
        font-weight: 600; 
        letter-spacing: normal;
        text-transform: none;
    }
    
    .translation-feature-container .feature-item p { 
        font-family: var(--font-sans); 
        color: var(--text-secondary); 
        line-height: 1.5; 
        margin: 0; 
        font-size: 0.9rem; 
    }

    /* Adjust spacing for form elements */
    .translation-feature-container .form-group {
        margin-bottom: 1.5rem;
    }
</style>

<div class="feature-container translation-feature-container">
    <h1><i class="fas fa-language"></i> Intelligent Document Translation</h1>
    <p class="feature-description">
        This <strong>AI Agent</strong> executes a sophisticated processing pipeline to translate complex documents while preserving original layout and formatting. Designed for automated language translation in over 200 language pairs.
    </p>
    
    <div class="feature-grid">
        <div class="feature-item">
            <h4><i class="fas fa-file-import" style="color: var(--brand-primary); margin-right: 8px;"></i> Intelligent Ingestion</h4>
            <p>Automatically detects source language and parses complex Word, PowerPoint, and Excel structures.</p>
        </div>
        <div class="feature-item">
            <h4><i class="fas fa-magic" style="color: var(--brand-primary); margin-right: 8px;"></i> Contextual AI</h4>
            <p>Uses advanced prompt engineering to ensure translation accuracy and nuance preservation.</p>
        </div>
        <div class="feature-item">
            <h4><i class="fas fa-print" style="color: var(--brand-primary); margin-right: 8px;"></i> Native Formatting</h4>
            <p>Reassembles the translated document, preserving layouts, fonts, and styles perfectly.</p>
        </div>
    </div>

    {% if not gcs_available or not gemini_configured %}
        <div class="message-item category-error" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
                <strong>Configuration Issue:</strong>
                {% if not gcs_available %}Cloud Storage is not available. {% endif %}
                {% if not gemini_configured %}Google Gemini AI is not configured. {% endif %}
                File processing is disabled.
            </div>
        </div>
    {% endif %}

    <form method="POST" action="{{ url_for('translation.process_translate_document') }}" enctype="multipart/form-data"
          hx-post="{{ url_for('translation.process_translate_document') }}"
          hx-target="#translation-results-area"
          hx-swap="innerHTML"
          hx-encoding="multipart/form-data"
          hx-indicator="#translation-submit-button .spinner">
        
        <!-- Pro Drop Zone -->
        <div class="form-group">
            <label for="translation-file-input" id="translation-drop-zone-label" class="drop-zone-style">
                <!-- Icon -->
                <i class="fas fa-cloud-upload-alt"></i>
                
                <!-- Main Text -->
                <div>
                    <p>Click to upload or drag and drop</p>
                    <p class="file-info" id="translation-file-name-display">Maximum file size 10MB</p>
                </div>

                <!-- Format Badges -->
                <div class="format-badges">
                    <span class="format-badge">DOCX</span>
                    <span class="format-badge">PPTX</span>
                    <span class="format-badge">XLSX</span>
                </div>
            </label>
            <input type="file" id="translation-file-input" name="file" accept=".docx,.pptx,.xlsx" required style="display: none;">
        </div>

        <div class="form-group">
            <label for="translation-target-language">Target Language</label>
            <select id="translation-target-language" name="target_language" required
                    {% if not gemini_configured %}disabled{% endif %}>
                {% if not languages and gemini_configured %}
                    <option value="" disabled selected>No languages configured</option>
                {% elif not gemini_configured %}
                     <option value="" disabled selected>Gemini Service Not Configured</option>
                {% else %}
                    <option value="" disabled selected>Select a language...</option>
                    {% for lang in languages %}
                        <option value="{{ lang }}">{{ lang }}</option>
                    {% endfor %}
                {% endif %}
            </select>
        </div>

        <div class="submit-area">
            <button type="submit" class="submit-button" id="translation-submit-button"
                    {% if not gcs_available or not gemini_configured %}disabled aria-disabled="true" title="Translation service is not fully configured." {% endif %}>
                <i class="fas fa-cogs"></i> Translate Document
                <span class="htmx-indicator spinner"></span>
            </button>
        </div>
    </form>

    <div id="translation-results-area" class="processing-result" style="margin-top: 1.5rem; border: none; padding: 0; background-color: transparent; min-height: 0;">
        <!-- Results will load here -->
    </div>
</div>

<script>
// Ensure global markdown renderer exists (fallback)
if (typeof window.renderMarkdownSummary !== 'function') {
    window.renderMarkdownSummary = function(markdownText, containerElement) {
        if (!markdownText || markdownText.trim() === "") {
            containerElement.innerHTML = '<p><i>No content to display.</i></p>';
            return;
        }
        // Basic line-break renderer if the complex one isn't loaded
        containerElement.innerHTML = markdownText.replace(/\n/g, '<br>');
    };
}

(function() {
    const translationFeatureContainer = document.querySelector('.translation-feature-container');
    if (!translationFeatureContainer) return;

    const dropZoneLabel = translationFeatureContainer.querySelector('#translation-drop-zone-label');
    const fileInput = translationFeatureContainer.querySelector('#translation-file-input');
    const fileNameDisplay = translationFeatureContainer.querySelector('#translation-file-name-display');

    if (dropZoneLabel && fileInput && fileNameDisplay) {
        
        // Drag over visual cue
        dropZoneLabel.addEventListener('dragover', (e) => { 
            e.preventDefault(); 
            dropZoneLabel.classList.add('drag-over'); 
        });

        // Drag leave visual cue
        dropZoneLabel.addEventListener('dragleave', () => { 
            dropZoneLabel.classList.remove('drag-over'); 
        });

        // Drop handler
        dropZoneLabel.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZoneLabel.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                // Trigger change event manually
                const event = new Event('change', { bubbles: true });
                fileInput.dispatchEvent(event);
            }
        });

        // File selection handler
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                // Update text to show filename
                fileNameDisplay.textContent = fileInput.files[0].name;
                fileNameDisplay.style.color = 'var(--brand-primary)';
                fileNameDisplay.style.fontWeight = '600';
                dropZoneLabel.classList.add('file-selected');
            } else {
                // Reset text
                fileNameDisplay.textContent = 'Maximum file size 10MB';
                fileNameDisplay.style.color = '';
                fileNameDisplay.style.fontWeight = '';
                dropZoneLabel.classList.remove('file-selected');
            }
        });
    }
})();
</script>