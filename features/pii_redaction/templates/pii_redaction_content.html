<!-- features/pii_redaction/templates/pii_redaction_content.html -->

{# Check if this is an HTMX request specifically for the result part #}
{% if request.headers.get('HX-Request') and hx_target_is_result %}
    {# --- This block is ONLY for HTMX swapping the result --- #}
    {% if redacted_text %}
        <h2>Redaction Result (Placeholder):</h2>
        <textarea id="redaction-output" rows="8" cols="60" readonly>{{ redacted_text }}</textarea>
        <p style="font-size: 0.85em; color: #777; margin-top: 5px;">(Read-only redacted output - copy as needed)</p>
    {% elif get_flashed_messages(with_categories=true) %}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% for category, message in messages %}
                <div class="message-item category-{{ category|default('info') }}" role="alert">
                    {% if category == 'error' %}<i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                    {% elif category == 'success' %}<i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                    {% elif category == 'warning' %}<i class="fas fa-exclamation-circle" style="margin-right: 8px;"></i>
                    {% else %}<i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                    {% endif %}
                    {{ message }}
                </div>
            {% endfor %}
        {% endwith %}
    {% else %}
        <p><i>No PII redaction performed yet.</i></p>
    {% endif %}
    {# --- End of HTMX result block --- #}
{% else %}
    {# --- This is the FULL initial rendering of the feature --- #}
    <div class="feature-container pii-redaction-tile-container"> {# Added pii-redaction-tile-container CLASS #}
        <h1><i class="fas fa-user-shield"></i> PII Redaction Service</h1>
        
        <div class="feature-explanation">
            <p>
                This service will identify and redact Personally Identifiable Information (PII) from your documents or pasted text.
                It helps protect sensitive data by obscuring or removing details like names, addresses, social security numbers, etc.
            </p>
            <p><em>(Full functionality for PII Redaction is under development.)</em></p>
        </div>

        <p class="upload-instructions">
            Upload a document (e.g., Word, PDF) or paste text below to have PII redacted.
        </p>

        <form hx-post="{{ url_for('process_redact') }}" hx-target="#pii-redaction-result" hx-swap="innerHTML" enctype="multipart/form-data">
            <div class="form-group">
                <label for="text_to_redact_paste">Paste Text (or leave blank to upload a file):</label>
                <textarea id="text_to_redact_paste" name="text_to_redact_paste" rows="8" cols="60"></textarea>
            </div>

            <div class="form-group">
                <label for="file_to_redact">Upload File (e.g., .txt, .docx, .pdf):</label>
                <input type="file" id="file_to_redact" name="file_to_redact" accept=".txt,.docx,.pdf,.rtf,.html">
            </div>

            <button type="submit" class="submit-button">
                <i class="fas fa-user-secret"></i> Redact PII (Demo)
                <span class="htmx-indicator spinner"></span>
            </button>
        </form>

        <div id="pii-redaction-result" class="processing-result">
            {# This div will be populated by HTMX #}
            {% if redacted_text %} {# For initial load if a value was somehow passed #}
                <h2>Redaction Result (Placeholder):</h2>
                <textarea id="redaction-output" rows="8" cols="60" readonly>{{ redacted_text }}</textarea>
                <p style="font-size: 0.85em; color: #777; margin-top: 5px;">(Read-only redacted output)</p>
            {% else %}
                <p><i>No PII redaction performed yet. Submit text or a file above.</i></p>
            {% endif %}
        </div>
    </div>
{% endif %}