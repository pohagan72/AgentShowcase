<!-- features/summarization/templates/summarization_content.html -->

{# Check if this is an HTMX request specifically for the summary result #}
{% if request.headers.get('HX-Request') and hx_target_is_result %}
    {# --- This block is ONLY for HTMX swapping the result --- #}
    {% if summary %}
        <h2>Summary:</h2>
        <textarea id="summary-output" rows="8" cols="60" readonly>{{ summary }}</textarea>
        <p style="font-size: 0.85em; color: #777; margin-top: 5px;">(Read-only summary - copy and paste as needed)</p>
    {% elif get_flashed_messages(with_categories=true) %} {# Also display flashed messages if any #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% for category, message in messages %}
                <div class="message-item category-{{ category|default('info') }}" role="alert">
                    {% if category == 'error' %}<i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                    {% elif category == 'success' %}<i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                    {% elif category == 'warning' %}<i class="fas fa-exclamation-circle" style="margin-right: 8px;"></i>
                    {% else %}<i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                    {% endif %}
                    {{ message }}
                </div>
            {% endfor %}
        {% endwith %}
    {% else %}
        <p><i>No summary generated yet. Upload a file or paste text above and click "Summarize".</i></p>
    {% endif %}
    {# --- End of HTMX result block --- #}
{% else %}
    {# --- This is the FULL initial rendering of the feature --- #}
    <div class="feature-container summarization-tile-container"> {# ADDED summarization-tile-container CLASS #}
        <h1>Intelligent Document Summarization</h1>
        
        <div class="feature-explanation"> {# MOVED STYLES TO CSS #}
            <h2>Our Approach to Summarization</h2>
            <p>
                This service utilizes a sophisticated two-step Generative AI (GenAI) process to deliver contextually relevant summaries.
                This approach enhances the quality and relevance of the output compared to generic summarization methods.
            </p>
            <ol>
                <li>
                    <strong>Document Classification:</strong> First, the GenAI model analyzes an excerpt of your uploaded document or pasted text to determine its type (e.g., Financial Report, Legal Contract, Technical Manual). This classification step is crucial for tailoring the subsequent summarization.
                </li>
                <li>
                    <strong>Context-Aware Summarization:</strong> Based on the identified document type, a specialized prompt is constructed. This prompt guides the GenAI model to focus on the aspects most critical for that specific type of document, ensuring the summary highlights key information pertinent to its context (e.g., core invention for a patent, financial highlights for a 10-K).
                </li>
            </ol>
            <p>
                This intelligent, type-specific approach allows the AI Agent to generate more insightful and actionable summaries, moving beyond simple text truncation or generic keyword extraction.
            </p>
        </div>

        <p class="upload-instructions"> {# Added a class for easier styling if needed #}
            Upload a Word, PowerPoint, Excel, or PDF file, or paste text below.
            Maximum text length for summarization is 1,000,000 characters.
        </p>

        <form hx-post="{{ url_for('process_summarize') }}" hx-target="#summarization-result" hx-swap="innerHTML" enctype="multipart/form-data">
            <div class="form-group">
                <label for="text_to_summarize">Paste Text (or leave blank to upload a file):</label>
                <textarea id="text_to_summarize" name="text_to_summarize" rows="8" cols="60"></textarea>
            </div>

            <div class="form-group">
                <label for="file">Upload File (.docx, .pptx, .xlsx, .pdf):</label>
                <input type="file" id="file" name="file" accept=".docx,.pptx,.xlsx,.pdf">
            </div>

            <button type="submit" class="submit-button">
                <i class="fas fa-file-alt"></i> Summarize
                <span class="htmx-indicator spinner"></span>
            </button>
        </form>

        <div id="summarization-result" class="processing-result">
            {# This div will be populated by HTMX #}
            {% if summary %} {# For initial load if a summary was somehow passed #}
                <h2>Summary:</h2>
                <textarea id="summary-output" rows="8" cols="60" readonly>{{ summary }}</textarea>
                <p style="font-size: 0.85em; color: #777; margin-top: 5px;">(Read-only summary - copy and paste as needed)</p>
            {% else %}
                <p><i>No summary generated yet. Upload a file or paste text above and click "Summarize".</i></p>
            {% endif %}
        </div>
    </div>
{% endif %}