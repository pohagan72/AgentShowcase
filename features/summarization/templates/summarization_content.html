<!-- features/summarization/templates/summarization_content.html -->

{# Check if this is an HTMX request specifically for the TEXT summary result #}
{% if request.headers.get('HX-Request') and hx_target_is_text_summary_result %}
    {# --- This block is ONLY for HTMX swapping the TEXT summary result --- #}
    {% if summary %}
        <h2>Summary:</h2>
        <textarea id="summary-output" rows="8" cols="60" readonly>{{ summary }}</textarea>
        <p style="font-size: 0.85em; color: #777; margin-top: 5px;">(Read-only summary - copy and paste as needed)</p>
    {% elif get_flashed_messages(with_categories=true) %}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% for category, message in messages %}
                <div class="message-item category-{{ category|default('info') }}" role="alert">
                    {% if category == 'error' %}<i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                    {% elif category == 'success' %}<i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                    {% elif category == 'warning' %}<i class="fas fa-exclamation-circle" style="margin-right: 8px;"></i>
                    {% else %}<i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                    {% endif %}
                    {{ message }}
                </div>
            {% endfor %}
        {% endwith %}
    {% else %}
        <p><i>No text summary generated yet or an issue occurred.</i></p>
    {% endif %}
{% elif request.headers.get('HX-Request') and hx_target_is_ppt_status_result %}
    {# --- This block is for HTMX swapping PPT status --- #}
    {% if ppt_error_message %}
        <div id="ppt-builder-status" class="ppt-builder-error">{{ ppt_error_message }}</div>
    {% elif ppt_success_message and ppt_download_url %} 
        <div id="ppt-builder-status" class="ppt-builder-success">
            {{ ppt_success_message }}
            <br>
            <a href="{{ ppt_download_url }}" id="download-btn" class="submit-button" style="margin-top: 1rem; display: inline-block; width: auto;">Download Presentation</a>
        </div>
    {% elif get_flashed_messages(with_categories=true) %}
         {% with messages = get_flashed_messages(with_categories=true) %}
            {% for category, message in messages %}
                <div class="message-item category-{{ category|default('info') }}" role="alert">
                     {{ message }}
                </div>
            {% endfor %}
        {% endwith %}
    {% else %}
        <p><i>PPT generation status updates might appear here if configured for HTMX.</i></p>
    {% endif %}
{% else %}
    {# --- This is the FULL initial rendering of the feature --- #}
    <div class="feature-container summarization-tile-container">
        <h1><i class="fas fa-file-alt"></i> Intelligent Document Summarization</h1>

        <div class="feature-tabs">
            <button class="tab-link active" data-target-tab="text-summary-tab">
                <i class="fas fa-align-left"></i> Create Text Summary
            </button>
            <button class="tab-link" data-target-tab="ppt-summary-tab">
                <i class="fas fa-file-powerpoint"></i> Create Executive PowerPoint
            </button>
        </div>

        <!-- Tab Content for Text Summary -->
        <div id="text-summary-tab" class="feature-tab-content active-content">
            <h2>Generate a Concise Text Summary</h2>
            <div class="feature-explanation" style="margin-top:15px;">
                <p>This service utilizes a sophisticated two-step GenAI process to deliver contextually relevant text summaries...</p>
                <ol><li><strong>Document Classification...</strong></li><li><strong>Context-Aware Summarization...</strong></li></ol>
                <p>This intelligent, type-specific approach has 20+ custom AI prompts...</p>
            </div>
            <p class="upload-instructions">Upload a Word, PowerPoint, Excel, or PDF file, or paste text below...</p>
            <form id="text-summary-form" hx-post="{{ url_for('process_summarize') }}" hx-target="#text-summarization-result" hx-swap="innerHTML" enctype="multipart/form-data" hx-indicator="#text-summary-tab .spinner">
                <div class="form-group">
                    <label for="text_to_summarize">Paste Text (or leave blank to upload a file):</label>
                    <textarea id="text_to_summarize" name="text_to_summarize" rows="8"></textarea>
                </div>
                <div class="form-group">
                    <label for="text-summary-file-input" id="text-summary-drop-zone-label" class="drop-zone-style" 
                           style="display: block; border: 2px dashed #007bff; padding: 20px; text-align: center; cursor: pointer; background-color: #f8f9fa; border-radius: 5px; margin-bottom: 10px;">
                        <p style="margin:0 0 5px 0; font-size: 1.0em; color: #333;">Drop .docx, .pptx, .xlsx, or .pdf file here, or click to select.</p>
                        <p id="text-summary-file-name-display" style="margin-top:5px; font-weight: bold; color: #555;">No file selected</p>
                    </label>
                    <input type="file" id="text-summary-file-input" name="file" accept=".docx,.pptx,.xlsx,.pdf"
                           style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;">
                </div>
                <button type="submit" class="submit-button">
                    <i class="fas fa-file-alt"></i> Summarize Text
                    <span class="htmx-indicator spinner"></span>
                </button>
            </form>
            <div id="text-summarization-result" class="processing-result">
                 {% if summary %} 
                    <h2>Summary:</h2>
                    <textarea id="summary-output" rows="8" readonly>{{ summary }}</textarea>
                    <p style="font-size: 0.85em; color: #777; margin-top: 5px;">(Read-only summary)</p>
                {% else %}
                    <p><i>Text summary will appear here.</i></p>
                {% endif %}
            </div>
        </div>

        <!-- SIMPLIFIED Tab Content for PPT Summary (URL option removed) -->
        <div id="ppt-summary-tab" class="feature-tab-content">
            <h2>Generate an Executive PowerPoint Summary</h2>
            <div class="feature-explanation" style="margin-top:15px;">
                 <p>
                    This tool creates executive-level PowerPoint presentations from your uploaded documents (e.g., Word, PDF, Python code).
                    It uses a multi-step AI process. Default presentation style will be used.
                </p>
            </div>

            {% if not ppt_api_key_configured %}
            <div class="ppt-builder-api-warning">
                <strong>Configuration Notice:</strong> {% if ppt_config_warning %}{{ ppt_config_warning }}{% else %}Core AI or Storage services may be unavailable. Presentation generation might fail.{% endif %}
            </div>
            {% endif %}

            <form id="ppt-builder-upload-form" action="{{ url_for('process_create_ppt') }}" method="POST" enctype="multipart/form-data">
                <input type="hidden" name="template" value="{{ ppt_default_template | default('professional') }}">
                {# ADDED HIDDEN INPUT FOR inputType #}
                <input type="hidden" name="inputType" value="file">

                <div class="ppt-builder-step-section">
                    {# MODIFIED: Title changed #}
                    <div class="ppt-builder-step-title"><span class="ppt-builder-step-number"></span></div>
                    
                    {# REMOVED: .ppt-builder-input-type-selector div (radio buttons) #}

                    <div id="ppt-builder-file-upload-section"> 
                         <label for="ppt-builder-file-input" id="ppt-builder-drop-zone-label" class="drop-zone-style"
                                style="display: block; border: 2px dashed #007bff; padding: 20px; text-align: center; cursor: pointer; background-color: #f8f9fa; border-radius: 5px; margin-bottom: 10px;">
                             <p style="margin:0 0 5px 0; font-size: 1.0em; color: #333;">
                                 Source Files ({{ ppt_allowed_extensions_str|default('.docx, .pdf, or .py') }}, up to {{ ppt_max_files|default(5) }} files, max {{ ppt_max_file_size_mb|default(10) }}MB each)
                             </p>
                             <p style="margin:0 0 10px 0; font-size: 1.0em; color: #333;">Drag & drop your file(s) here or click to select.</p>
                             <div id="ppt-builder-file-info" style="margin-top:10px; font-weight: bold; color: #555;"><p class="ppt-builder-no-files-msg">No files selected.</p></div>
                         </label>
                         <input type="file" id="ppt-builder-file-input" name="file" accept="{{ ppt_allowed_extensions_str|default('.docx,.pdf,.py') }}" 
                                style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;" multiple>
                    </div>
                    
                    {# REMOVED: div#ppt-builder-url-input-section #}
                </div>
                <button type="submit" id="ppt-builder-convert-btn" class="submit-button" {% if not ppt_api_key_configured %}disabled{% endif %}>
                    <i class="fas fa-magic"></i> Generate Presentation
                </button>
            </form>

            <div class="ppt-builder-loader-container" id="ppt-builder-loader-container">
                 <div id="ppt-builder-loader" class="ppt-builder-loader"></div>
                 <p id="ppt-builder-loader-text">Processing...</p>
            </div>
            <div id="ppt-builder-status-container" class="processing-result" style="min-height: 50px;">
                <div id="ppt-builder-status">
                    <p><i>PowerPoint generation status and download link will appear here.</i></p>
                </div>
            </div>
        </div> <!-- End of ppt-summary-tab -->

    </div> {# End of summarization-tile-container #}

    <script>
    // Self-invoking function to scope all JS for this feature
    (function() {
        const summarizationFeatureContainer = document.querySelector('.summarization-tile-container');
        if (!summarizationFeatureContainer) {
            return;
        }

        // --- Tab Switching Logic (Remains the same) ---
        const tabLinks = summarizationFeatureContainer.querySelectorAll('.feature-tabs .tab-link');
        const tabContents = summarizationFeatureContainer.querySelectorAll('.feature-tab-content');
        function openSummarizationTab(targetTabId) {
            tabContents.forEach(tc => { tc.style.display = 'none'; tc.classList.remove('active-content'); });
            tabLinks.forEach(tl => tl.classList.remove('active'));
            const currentTabContent = summarizationFeatureContainer.querySelector('#' + targetTabId);
            const currentTabLink = summarizationFeatureContainer.querySelector(`.feature-tabs .tab-link[data-target-tab="${targetTabId}"]`);
            if (currentTabContent) { currentTabContent.style.display = 'block'; currentTabContent.classList.add('active-content'); }
            if (currentTabLink) { currentTabLink.classList.add('active'); }
        }
        tabLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const targetTabId = this.dataset.targetTab;
                if (targetTabId) { openSummarizationTab(targetTabId); }
            });
        });
        if (tabLinks.length > 0 && !summarizationFeatureContainer.querySelector('.feature-tabs .tab-link.active')) {
             const firstTabId = tabLinks[0].dataset.targetTab;
             if (firstTabId) openSummarizationTab(firstTabId);
        }


        // --- Text Summary Tab File Upload Logic (Remains the same) ---
        const textSummaryDropZoneLabel = summarizationFeatureContainer.querySelector('#text-summary-drop-zone-label');
        const textSummaryFileInput = summarizationFeatureContainer.querySelector('#text-summary-file-input');
        const textSummaryFileNameDisplay = summarizationFeatureContainer.querySelector('#text-summary-file-name-display');
        const textSummaryForm = summarizationFeatureContainer.querySelector('#text-summary-form');
        if (textSummaryDropZoneLabel && textSummaryFileInput && textSummaryFileNameDisplay && textSummaryForm) {
            textSummaryDropZoneLabel.addEventListener('dragover', (e) => { e.preventDefault(); textSummaryDropZoneLabel.classList.add('drag-over'); textSummaryDropZoneLabel.style.borderColor = '#28a745'; });
            textSummaryDropZoneLabel.addEventListener('dragleave', () => { textSummaryDropZoneLabel.classList.remove('drag-over'); textSummaryDropZoneLabel.style.borderColor = '#007bff'; });
            textSummaryDropZoneLabel.addEventListener('drop', (e) => { e.preventDefault(); textSummaryDropZoneLabel.classList.remove('drag-over'); textSummaryDropZoneLabel.style.borderColor = '#007bff'; const files = e.dataTransfer.files; if (files.length > 0) { textSummaryFileInput.files = files; const event = new Event('change', { bubbles: true }); textSummaryFileInput.dispatchEvent(event); } });
            textSummaryFileInput.addEventListener('change', () => { if (textSummaryFileInput.files.length > 0) { textSummaryFileNameDisplay.textContent = textSummaryFileInput.files[0].name; textSummaryDropZoneLabel.classList.add('file-selected'); textSummaryDropZoneLabel.style.borderColor = '#28a745'; } else { textSummaryFileNameDisplay.textContent = 'No file selected'; textSummaryDropZoneLabel.classList.remove('file-selected'); textSummaryDropZoneLabel.style.borderColor = '#007bff'; } });
            textSummaryForm.addEventListener('submit', function(event) { const textToSummarizeInput = summarizationFeatureContainer.querySelector('#text_to_summarize'); if (textSummaryFileInput.files.length === 0 && (!textToSummarizeInput || textToSummarizeInput.value.trim() === '')) { alert('Please upload a file or paste text to summarize.'); event.preventDefault(); } });
        }

        // --- SIMPLIFIED PPT Builder Specific JavaScript (URL option and popups removed) ---
        const pptBuilderForm = summarizationFeatureContainer.querySelector('#ppt-builder-upload-form');
        if (pptBuilderForm) {
            const pptDropZoneLabel = summarizationFeatureContainer.querySelector('#ppt-builder-drop-zone-label'); 
            const pptFileInput = summarizationFeatureContainer.querySelector('#ppt-builder-file-input');
            const pptConvertBtn = summarizationFeatureContainer.querySelector('#ppt-builder-convert-btn');
            const pptStatusDiv = summarizationFeatureContainer.querySelector('#ppt-builder-status');
            const pptStatusContainer = summarizationFeatureContainer.querySelector('#ppt-builder-status-container');
            const pptLoaderContainer = summarizationFeatureContainer.querySelector('#ppt-builder-loader-container');
            const pptLoaderText = summarizationFeatureContainer.querySelector('#ppt-builder-loader-text');
            const pptFileInfoDiv = summarizationFeatureContainer.querySelector('#ppt-builder-file-info');

            // const pptCurrentInputType = 'file'; // Hardcoded, no longer needed as a variable here
            let pptValidFiles = [];
            
            const PPT_MAX_FILES = parseInt("{{ ppt_max_files|default(5) }}", 10);
            const PPT_MAX_FILE_SIZE_MB = parseInt("{{ ppt_max_file_size_mb|default(10) }}", 10);
            const PPT_MAX_FILE_SIZE = PPT_MAX_FILE_SIZE_MB * 1024 * 1024;
            const PPT_ALLOWED_EXTENSIONS_STR = "{{ ppt_allowed_extensions_str|default('.docx,.pdf,.py') }}";
            const PPT_ALLOWED_EXTENSIONS = PPT_ALLOWED_EXTENSIONS_STR.split(',').map(ext => ext.trim().replace('.', ''));
            const pptApiKeyIsConfigured = {{ ppt_api_key_configured|default(false)|tojson }};

            // --- START: Core PPT Function Definitions (Simplified Set) ---
            // REMOVED: initializePptPopup, selectPptOption, handlePptInputTypeChange, isValidPptHttpUrl

            function updatePptConvertButtonState() {
                 if(!pptConvertBtn) return;
                 const isReady = pptValidFiles.length > 0;
                 pptConvertBtn.disabled = !isReady || !pptApiKeyIsConfigured;
            }
            function handlePptFileSelection(fileList) { 
                clearPptStatus(); pptValidFiles = [];
                let invalidCount = 0; let typeErrorCount = 0; let sizeErrorCount = 0;
                const totalSelected = fileList.length;
                if (totalSelected > PPT_MAX_FILES) { 
                    showPptStatus(`Too many files selected (${totalSelected}). Max: ${PPT_MAX_FILES}.`, 'error'); 
                    resetPptFileInput(); return; 
                }
                for (const file of fileList) {
                    const fileExt = file.name.split('.').pop()?.toLowerCase() || '';
                    let isTypeValid = PPT_ALLOWED_EXTENSIONS.includes(fileExt);
                    let isSizeValid = file.size <= PPT_MAX_FILE_SIZE;
                    if (isTypeValid && isSizeValid) { pptValidFiles.push(file); }
                    else {
                        invalidCount++;
                        if (!isTypeValid) typeErrorCount++;
                        if (!isSizeValid) sizeErrorCount++;
                    }
                }
                displayPptFileInfo(pptValidFiles, invalidCount, typeErrorCount, sizeErrorCount);
                updatePptConvertButtonState(); // Update button state after file selection
            }
            function displayPptFileInfo(validFiles, invalidCount, typeErrorCount, sizeErrorCount) { 
                if (!pptFileInfoDiv) return;
                pptFileInfoDiv.innerHTML = ''; 
                if (validFiles.length > 0) {
                    const p = document.createElement('p');
                    p.textContent = `Selected Files (${validFiles.length}):`;
                    p.style.color = 'var(--success-text, #0f5132)'; 
                    p.style.fontWeight = 'normal'; p.style.textAlign = 'left'; p.style.marginBottom = '0.3rem';
                    pptFileInfoDiv.appendChild(p);
                    const ul = document.createElement('ul');
                    ul.style.listStyleType = 'none'; ul.style.paddingLeft = '0'; ul.style.textAlign = 'left';
                    validFiles.forEach(file => { 
                        const li = document.createElement('li'); 
                        li.textContent = `${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                        li.style.fontSize = '0.9em'; li.style.marginBottom = '0.2rem';
                        ul.appendChild(li); 
                    });
                    pptFileInfoDiv.appendChild(ul);
                } else if (invalidCount === 0) {
                    pptFileInfoDiv.innerHTML = '<p class="ppt-builder-no-files-msg" style="font-weight:normal; color:#555;">No files selected.</p>';
                }
                if (invalidCount > 0) {
                    const pWarn = document.createElement('p'); 
                    pWarn.style.color = 'var(--error-text, #842029)';
                    pWarn.style.fontSize = '0.9em'; pWarn.style.marginTop = '0.5rem'; pWarn.style.textAlign = 'left';
                    let warnMsgParts = [];
                    if (typeErrorCount > 0) warnMsgParts.push(`invalid type (allowed: ${PPT_ALLOWED_EXTENSIONS.join(', ')})`);
                    if (sizeErrorCount > 0) warnMsgParts.push(`too large (max ${PPT_MAX_FILE_SIZE_MB}MB)`);
                    pWarn.textContent = `${invalidCount} file(s) ignored: ${warnMsgParts.join(' and ')}.`;
                    pptFileInfoDiv.appendChild(pWarn);
                }
            }
            function resetPptFileInput() { 
                 if(pptFileInput) pptFileInput.value = ''; 
                pptValidFiles = []; 
                displayPptFileInfo([], 0, 0, 0); 
                updatePptConvertButtonState();
            }
            function setPptUIState(processing) { 
                const formElements = pptBuilderForm.elements;
                for (let i = 0; i < formElements.length; i++) {
                    if (formElements[i].type !== 'hidden') formElements[i].disabled = processing;
                }
                if (pptDropZoneLabel) {
                    pptDropZoneLabel.style.opacity = processing ? 0.6 : 1;
                    pptDropZoneLabel.style.cursor = processing ? 'not-allowed' : 'pointer';
                    pptDropZoneLabel.style.pointerEvents = processing ? 'none' : 'auto';
                }
                if (pptLoaderContainer) pptLoaderContainer.style.display = processing ? 'flex' : 'none';
                if (!processing) updatePptConvertButtonState(); 
                else { if(pptConvertBtn) pptConvertBtn.disabled = true; clearPptStatus(); }
            }
            function updatePptLoaderText(text) { if(pptLoaderText) pptLoaderText.textContent = text; }
            function showPptStatus(message, type) { 
                clearPptStatus(); 
                if(pptStatusDiv) {
                    pptStatusDiv.innerHTML = '';
                    const p = document.createElement('p');
                    p.textContent = message;
                    pptStatusDiv.appendChild(p);
                    pptStatusDiv.className = 'ppt-builder-' + type; 
                    if (pptStatusContainer) pptStatusContainer.style.display = 'block';
                }
            }
            function clearPptStatus() { 
                if(pptStatusDiv) {
                    pptStatusDiv.innerHTML = '<p><i>PowerPoint generation status and download link will appear here.</i></p>';
                    pptStatusDiv.className = '';
                }
                const btn = summarizationFeatureContainer.querySelector('#ppt-builder-status #download-btn'); 
                if (btn) btn.remove();
            }

            function handlePptFormSubmit(event) {
                event.preventDefault(); clearPptStatus();
                const formData = new FormData(pptBuilderForm);
                // 'inputType' is now set by a hidden field, so no need to set it via JS here.

                if (pptValidFiles.length === 0) { 
                    showPptStatus('Please select valid file(s).', 'error'); return; 
                }
                formData.delete('file'); 
                pptValidFiles.forEach(file => formData.append('file', file, file.name));
                // No 'sourceUrl' to delete as it's not in the form.

                setPptUIState(true); 
                updatePptLoaderText('Preparing request...');

                fetch(pptBuilderForm.action, { method: 'POST', body: formData })
                .then(async response => { /* ... (fetch response handling - REMAINS THE SAME) ... */ 
                    updatePptLoaderText('Waiting for server...');
                    if (!response.ok) {
                        let errorMsg = 'Processing failed on server.';
                        try { const errData = await response.json(); errorMsg = errData.error || `Server error (${response.status}).`; }
                        catch (jsonError) { errorMsg = `Server error (${response.status} ${response.statusText}). Invalid JSON response.`; }
                        if (response.status === 503) errorMsg = errorMsg.includes("AI service unavailable") ? errorMsg : "Service is temporarily busy. Please try again shortly.";
                        throw new Error(errorMsg);
                    }
                    const contentType = response.headers.get("content-type");
                    if (contentType && contentType.includes('application/vnd.openxmlformats-officedocument.presentationml.presentation')) {
                         updatePptLoaderText('Downloading presentation...'); return response.blob();
                    } else { 
                        try { const errData = await response.json(); throw new Error(errData.error || 'Server returned an unexpected response type.'); }
                        catch(e) { throw new Error(e.message || 'Server returned an unexpected response type and invalid error format.');}
                    }
                })
                .then(blob => { /* ... (fetch success handling - REMAINS THE SAME) ... */ 
                     updatePptLoaderText('Presentation ready!'); 
                     showPptStatus('Presentation generated successfully!', 'success');
                     const downloadLink = document.createElement('a');
                     const langSuffix = ''; 
                     let baseName = "presentation";
                     // Simplified baseName logic as only file input is possible
                     if (pptValidFiles.length === 1) { const fn = pptValidFiles[0].name; baseName = fn.substring(0, fn.lastIndexOf('.')) || 'document'; } 
                     else if (pptValidFiles.length > 1) { baseName = `${pptValidFiles.length}_docs`; }
                     const safeBaseName = baseName.replace(/[^\w\-]+/g, '_').replace(/_+/g, '_').substring(0, 50);
                     const downloadFilename = `${safeBaseName}_presentation${langSuffix}_${new Date().toISOString().split('T')[0].replace(/-/g,'')}.pptx`;
                     downloadLink.href = window.URL.createObjectURL(blob);
                     downloadLink.download = downloadFilename;
                     downloadLink.textContent = `Download: ${downloadFilename}`;
                     downloadLink.className = 'submit-button';
                     downloadLink.style.marginTop = '1rem';
                     downloadLink.style.display = 'inline-block';
                     downloadLink.style.width = 'auto';
                     if (pptStatusDiv) {
                        const successMsgP = pptStatusDiv.querySelector('p');
                        if (successMsgP) successMsgP.insertAdjacentElement('afterend', downloadLink);
                        else pptStatusDiv.appendChild(downloadLink);
                     }
                })
                .catch(error => { console.error('PPT Generation Error:', error); showPptStatus(`Error: ${error.message}`, 'error'); })
                .finally(() => { setPptUIState(false); if (pptLoaderContainer) pptLoaderContainer.style.display = 'none';});
            }
            // --- END: Core PPT Function Definitions ---

            // Initializations for PPT Builder
            if(pptFileInput) pptFileInput.addEventListener('change', function(e) { 
                if (e.target.files.length) { handlePptFileSelection(e.target.files); } 
                // updatePptConvertButtonState(); // handlePptFileSelection now calls this
            });
            if(pptDropZoneLabel) {
                pptDropZoneLabel.addEventListener('dragover', (e) => { e.preventDefault(); pptDropZoneLabel.classList.add('drag-over'); pptDropZoneLabel.style.borderColor = '#28a745';});
                ['dragleave', 'dragend'].forEach(type => pptDropZoneLabel.addEventListener(type, (e) => { e.preventDefault(); pptDropZoneLabel.classList.remove('drag-over'); pptDropZoneLabel.style.borderColor = '#007bff';}));
                pptDropZoneLabel.addEventListener('drop', (e) => {  e.preventDefault(); pptDropZoneLabel.classList.remove('drag-over'); pptDropZoneLabel.style.borderColor = '#007bff'; if (e.dataTransfer.files.length) { handlePptFileSelection(e.dataTransfer.files); if(pptFileInput) pptFileInput.files = e.dataTransfer.files; } /*updatePptConvertButtonState();*/ });
            }
            // Removed event listeners for URL input and radio buttons
            if(pptBuilderForm) pptBuilderForm.addEventListener('submit', handlePptFormSubmit);
            if(pptConvertBtn) updatePptConvertButtonState(); // Initial button state
            if(pptFileInfoDiv) displayPptFileInfo([],0,0,0); // Initial file info display
        } 
    })(); 
    </script>
{% endif %}